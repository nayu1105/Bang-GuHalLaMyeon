<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.mycom.myapp.review.dao.ReviewDao">

	<!-- 리뷰 별점 평균 조회 -->
	<select id="reviewAvgRate" parameterType="map" resultType="Integer">
		select AVG(rate) as avgRate 
		  from HOUSEREVIEW
		 where house_no=#{houseNo}
	</select>

	<!-- 리뷰 등록 -->
	<insert id="reviewInsert" parameterType="com.mycom.myapp.review.dto.ReviewDto">
		insert into HOUSEREVIEW (title, content, user_seq, house_no, rate, reg_dt)
		values ( #{title}, #{content}, #{userSeq}, #{houseNo}, #{rate}, now())
	</insert>
	
	<!-- 리뷰 삭제 -->
	<delete id="reviewDelete" parameterType="int">
		 delete from HOUSEREVIEW where review_id = #{reviewId}
	</delete>	

	<!-- 리뷰 detail -->
	<select id="reviewDetail" parameterType="int" resultType="com.mycom.myapp.review.dto.ReviewDto">
		select review_id, user_name, title, content, rate, reg_dt 
		from HOUSEREVIEW
		where review_id = #{reviewId}
	</select>
	
	<!-- 리뷰 전체 조회 -->
	<select id="reviewList" parameterType="map" resultType="com.mycom.myapp.review.dto.ReviewDto">
		 select h.review_id, h.title, h.content, u.user_name, h.rate, h.reg_dt, h.house_no, h.user_seq
		 from HOUSEREVIEW h, USERS u
		 where h.user_seq = u.user_seq and house_no = #{houseNo}
		 order by review_id desc
		 limit #{limit} offset #{offset}
	</select>
	
	<!-- 리뷰 전체 count -->
	<select id="reviewListTotalCnt" resultType="int">
	select count(*) from HOUSEREVIEW where house_no = #{houseNo}
	</select>
	
</mapper>